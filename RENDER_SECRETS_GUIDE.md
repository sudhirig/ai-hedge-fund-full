# 🔐 Render Secrets Management Guide

## 🎯 Overview
Render provides secure environment variable management for all your API keys and sensitive configuration. This guide shows you exactly what secrets to set and where.

## 🛡️ Security Features
- ✅ **Encrypted storage** - All secrets encrypted at rest
- ✅ **Secure transmission** - Encrypted in transit to your services  
- ✅ **Access control** - Only your services can access them
- ✅ **No logging** - Secrets never appear in logs
- ✅ **Service isolation** - Each service gets only its own secrets
- ✅ **Audit trail** - All changes tracked

## 📋 Backend Service Secrets

### Required Environment Variables
Set these in your **backend service** environment tab:

```bash
# API Keys (REQUIRED)
FINANCIAL_DATASETS_API_KEY=your_financial_datasets_api_key_here
ANTHROPIC_API_KEY=your_anthropic_api_key_here
OPENAI_API_KEY=your_openai_api_key_here

# Database (AUTO-GENERATED by Render)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Application Configuration
ENVIRONMENT=production
DEBUG=false
PYTHON_VERSION=3.9

# Optional: CORS Configuration (if needed)
CORS_ORIGINS=https://your-frontend-service.onrender.com
```

### How to Set Backend Secrets
1. Go to your backend service in Render dashboard
2. Click **"Environment"** tab
3. Click **"Add Environment Variable"**
4. Add each variable above (replace with your actual keys)
5. Click **"Save Changes"**
6. Service will automatically redeploy

## 📋 Frontend Service Secrets

### Required Environment Variables
Set these in your **frontend service** environment tab:

```bash
# API Configuration
REACT_APP_API_URL=https://your-backend-service.onrender.com
REACT_APP_ENVIRONMENT=production

# Build Configuration
GENERATE_SOURCEMAP=false
NODE_VERSION=18

# Optional: Analytics/Tracking (if you add them later)
# REACT_APP_GOOGLE_ANALYTICS_ID=your_ga_id_here
# REACT_APP_SENTRY_DSN=your_sentry_dsn_here
```

### How to Set Frontend Secrets
1. Go to your frontend service in Render dashboard
2. Click **"Environment"** tab
3. Click **"Add Environment Variable"**
4. Add each variable above
5. Click **"Save Changes"**
6. Service will automatically rebuild and redeploy

## 🗄️ Database Service

### PostgreSQL Configuration
Render automatically generates and manages:
- `DATABASE_URL` - Full connection string
- `POSTGRES_HOST` - Database host
- `POSTGRES_PORT` - Database port (usually 5432)
- `POSTGRES_DB` - Database name
- `POSTGRES_USER` - Database username
- `POSTGRES_PASSWORD` - Database password

**You don't need to set these manually** - Render handles them automatically.

## 🔗 Service Linking

### Automatic Database Linking
When you create your backend service:
1. Render automatically detects your PostgreSQL dependency
2. Sets `DATABASE_URL` environment variable
3. Links services securely within Render's network

### Frontend-Backend Linking
Update your frontend's `REACT_APP_API_URL` to point to your backend:
```bash
REACT_APP_API_URL=https://ai-hedge-fund-backend.onrender.com
```

## 🔍 Secret Validation

### Backend Health Check
Your backend `/health` endpoint will validate:
- Database connection
- API key availability
- Service configuration

### Frontend Build Check
Your frontend build will validate:
- API URL accessibility
- Environment configuration
- Build optimization settings

## 🚨 Security Best Practices

### DO:
- ✅ Use Render's environment variables for all secrets
- ✅ Use different API keys for production vs development
- ✅ Regularly rotate API keys
- ✅ Monitor usage in API provider dashboards
- ✅ Use least-privilege API key permissions

### DON'T:
- ❌ Never commit secrets to Git
- ❌ Never hardcode API keys in source code
- ❌ Never share production API keys
- ❌ Never use development keys in production
- ❌ Never log or print secret values

## 🔄 Updating Secrets

### To Update a Secret:
1. Go to service dashboard
2. Click **"Environment"** tab
3. Find the variable to update
4. Click **"Edit"**
5. Enter new value
6. Click **"Save Changes"**
7. Service automatically redeploys with new secret

### Emergency Key Rotation:
1. Generate new API key from provider
2. Update in Render dashboard
3. Service redeploys automatically
4. Revoke old API key from provider

## 📊 Monitoring Secrets

### Check Secret Usage:
- Monitor API usage in provider dashboards
- Check Render service logs for connection issues
- Use health check endpoints to validate configuration
- Set up alerts for API quota limits

## 🎯 Deployment Checklist

### Before Deploying:
- [ ] All API keys obtained from providers
- [ ] API keys have correct permissions
- [ ] Development vs production keys identified
- [ ] Backup access to all API provider accounts

### After Deploying:
- [ ] Health check endpoint returns 200
- [ ] Database connection successful
- [ ] API calls working in application
- [ ] No secret-related errors in logs
- [ ] All services can communicate

## 🆘 Troubleshooting

### Common Issues:
1. **Invalid API Key**: Check key format and permissions
2. **Database Connection**: Verify DATABASE_URL is set correctly
3. **CORS Errors**: Update CORS_ORIGINS with frontend URL
4. **Build Failures**: Check all required environment variables are set

### Debug Steps:
1. Check service logs in Render dashboard
2. Verify all environment variables are set
3. Test API keys in provider dashboards
4. Check service health endpoints
5. Contact Render support if needed

## 📞 Support

### Render Support:
- Dashboard: Live chat support
- Email: support@render.com
- Documentation: render.com/docs
- Community: community.render.com

### API Provider Support:
- Financial Datasets: Check their documentation
- Anthropic: docs.anthropic.com
- OpenAI: platform.openai.com/docs
